@model Inredningsbutik.Web.ViewModels.CustomerServiceIndexVm

@{
    ViewData["Title"] = "Kundtjänst";
}

<div class="container py-4 customer-service">
    <div class="text-center mb-4">
        <h1 class="cs-title">KUNDTJÄNST</h1>
        <p class="cs-lead">
            Här kan du hitta svar på vanliga frågor. Välj ett ämne till vänster.
        </p>
    </div>

    <div class="row g-4">
        <!-- Vänsterspalt -->
        <div class="col-12 col-lg-4">
            <div class="cs-nav">
                <button class="cs-nav-item is-active" type="button" data-section="kontakt">
                    <img class="cs-icon" src="~/images/icons/kontaktikon.png" alt="" />
                    <span>Kontakt</span>
                </button>

                <button class="cs-nav-item" type="button" data-section="populara">
                    <img class="cs-icon" src="~/images/icons/frågorikon.png" alt="" />
                    <span>Populära frågor</span>
                </button>

                <button class="cs-nav-item" type="button" data-section="leveranser">
                    <img class="cs-icon" src="~/images/icons/leveranserikon.png" alt="" />
                    <span>Leveranser</span>
                </button>

                <button class="cs-nav-item" type="button" data-section="retur">
                    <img class="cs-icon" src="~/images/icons/återbetikon.png" alt="" />
                    <span>Retur &amp; Återbetalning</span>
                </button>

                <button class="cs-nav-item" type="button" data-section="reklamation">
                    <img class="cs-icon" src="~/images/icons/reklamationerikon.png" alt="" />
                    <span>Reklamation</span>
                </button>

                <button class="cs-nav-item" type="button" data-section="betalning">
                    <img class="cs-icon" src="~/images/icons/fakturaikon.png" alt="" />
                    <span>Betalning &amp; Faktura</span>
                </button>
            </div>
        </div>

        <!-- Högerinnehåll -->
        <div class="col-12 col-lg-8">

            <!-- ======================= KONTAKT + FORM ======================= -->
            <section class="cs-section" data-section="kontakt">
                <h2 class="cs-h2">Kontakt</h2>

                <div class="card cs-card mb-4">
                    <div class="card-body">
                        <p class="mb-2"><strong>E-post:</strong> support@persdotter.se</p>
                        <p class="mb-2"><strong>Telefon:</strong> 08-123 45 67</p>
                        <p class="mb-0"><strong>Öppettider:</strong> Mån–Fre 10–15</p>
                    </div>
                </div>

                  @if (TempData["CustomerServiceToast"] is string msg)
    {
        <div class="alert alert-success mt-3">@msg</div>
    }

                <div class="card cs-card">
                    <div class="card-body">
                        <h5 class="mb-3">Skicka ett meddelande</h5>

                        <form asp-action="CreateTicket" method="post">
                            @Html.AntiForgeryToken()

                            <div class="mb-2">
                                <label class="form-label">Namn</label>
                                <input class="form-control" asp-for="Ticket.Name" />
                                <span class="text-danger" asp-validation-for="Ticket.Name"></span>
                            </div>

                            <div class="mb-2">
                                <label class="form-label">E-post</label>
                                <input class="form-control" asp-for="Ticket.Email" />
                                <span class="text-danger" asp-validation-for="Ticket.Email"></span>
                            </div>

                            <div class="mb-2">
                                <label class="form-label">Ämne</label>
                                <input class="form-control" asp-for="Ticket.Subject" />
                                <span class="text-danger" asp-validation-for="Ticket.Subject"></span>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Meddelande</label>
                                <textarea class="form-control" asp-for="Ticket.Message" rows="4"></textarea>
                                <span class="text-danger" asp-validation-for="Ticket.Message"></span>
                            </div>

                            <button class="btn btn-primary" type="submit">Skicka ärende</button>
                        </form>
                    </div>
                </div>
            </section>


            <!-- ======================= FAQ RENDER HELPER ======================= -->
            @functions {
                List<Inredningsbutik.Core.Entities.FaqItem> GetFaq(string key)
                {
                    if (Model.FaqByCategory.ContainsKey(key))
                        return Model.FaqByCategory[key];

                    return new List<Inredningsbutik.Core.Entities.FaqItem>();
                }
            }


            <!-- ======================= POPULÄRA ======================= -->
            <section class="cs-section d-none" data-section="populara">
                <h2 class="cs-h2">Populära frågor</h2>
                @{ var popularaItems = GetFaq("populara"); }

                @if (!popularaItems.Any())
                {
                    <p>Inga frågor publicerade ännu.</p>
                }
                else
                {
                    <div class="accordion" id="accPopulara">
                        @for (int i = 0; i < popularaItems.Count; i++)
                        {
                            var q = popularaItems[i];
                            var id = $"pop{i}";
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#@id">
                                        @q.Question
                                    </button>
                                </h2>
                                <div id="@id" class="accordion-collapse collapse" data-bs-parent="#accPopulara">
                                    <div class="accordion-body">@q.Answer</div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </section>


            <!-- ======================= LEVERANSER ======================= -->
            <section class="cs-section d-none" data-section="leveranser">
                <h2 class="cs-h2">Leveranser</h2>
                @{ var leveransItems = GetFaq("leveranser"); }

                @if (!leveransItems.Any())
                {
                    <p>Inga frågor publicerade ännu.</p>
                }
                else
                {
                    <div class="accordion" id="accLeveranser">
                        @for (int i = 0; i < leveransItems.Count; i++)
                        {
                            var q = leveransItems[i];
                            var id = $"lev{i}";
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#@id">
                                        @q.Question
                                    </button>
                                </h2>
                                <div id="@id" class="accordion-collapse collapse" data-bs-parent="#accLeveranser">
                                    <div class="accordion-body">@q.Answer</div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </section>


            <!-- ======================= RETUR ======================= -->
            <section class="cs-section d-none" data-section="retur">
                <h2 class="cs-h2">Retur &amp; Återbetalning</h2>
                @{ var returItems = GetFaq("retur"); }

                @if (!returItems.Any())
                {
                    <p>Inga frågor publicerade ännu.</p>
                }
                else
                {
                    <div class="accordion" id="accRetur">
                        @for (int i = 0; i < returItems.Count; i++)
                        {
                            var q = returItems[i];
                            var id = $"ret{i}";
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#@id">
                                        @q.Question
                                    </button>
                                </h2>
                                <div id="@id" class="accordion-collapse collapse" data-bs-parent="#accRetur">
                                    <div class="accordion-body">@q.Answer</div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </section>


            <!-- ======================= REKLAMATION ======================= -->
            <section class="cs-section d-none" data-section="reklamation">
                <h2 class="cs-h2">Reklamation</h2>
                @{ var reklamationItems = GetFaq("reklamation"); }

                @if (!reklamationItems.Any())
                {
                    <p>Inga frågor publicerade ännu.</p>
                }
                else
                {
                    <div class="accordion" id="accReklamation">
                        @for (int i = 0; i < reklamationItems.Count; i++)
                        {
                            var q = reklamationItems[i];
                            var id = $"rek{i}";
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#@id">
                                        @q.Question
                                    </button>
                                </h2>
                                <div id="@id" class="accordion-collapse collapse" data-bs-parent="#accReklamation">
                                    <div class="accordion-body">@q.Answer</div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </section>


            <!-- ======================= BETALNING ======================= -->
            <section class="cs-section d-none" data-section="betalning">
                <h2 class="cs-h2">Betalning &amp; Faktura</h2>
                @{ var betalningItems = GetFaq("betalning"); }

                @if (!betalningItems.Any())
                {
                    <p>Inga frågor publicerade ännu.</p>
                }
                else
                {
                    <div class="accordion" id="accBetalning">
                        @for (int i = 0; i < betalningItems.Count; i++)
                        {
                            var q = betalningItems[i];
                            var id = $"bet{i}";
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#@id">
                                        @q.Question
                                    </button>
                                </h2>
                                <div id="@id" class="accordion-collapse collapse" data-bs-parent="#accBetalning">
                                    <div class="accordion-body">@q.Answer</div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </section>

        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
    (function () {
        const navItems = document.querySelectorAll(".cs-nav-item");
        const sections = document.querySelectorAll(".cs-section");

        function show(sectionKey) {
            sections.forEach(s => s.classList.toggle("d-none", s.dataset.section !== sectionKey));
            navItems.forEach(b => b.classList.toggle("is-active", b.dataset.section === sectionKey));
            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        navItems.forEach(btn => {
            btn.addEventListener("click", () => show(btn.dataset.section));
        });
    })();
    </script>
}
